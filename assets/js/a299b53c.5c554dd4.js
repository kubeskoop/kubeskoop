"use strict";(self.webpackChunkkubeskoop_io=self.webpackChunkkubeskoop_io||[]).push([[6184],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),u=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},k="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),k=u(n),m=r,c=k["".concat(p,".").concat(m)]||k[m]||s[m]||l;return n?a.createElement(c,o(o({ref:t},d),{},{components:n})):a.createElement(c,o({ref:t},d))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[k]="string"==typeof e?e:r,o[1]=i;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1878:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>s,frontMatter:()=>l,metadata:()=>i,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const l={},o="Install KubeSkoop exporter",i={unversionedId:"guide/exporter/exporter_installation",id:"guide/exporter/exporter_installation",title:"Install KubeSkoop exporter",description:"Dependencies",source:"@site/docs/guide/exporter/exporter_installation.md",sourceDirName:"guide/exporter",slug:"/guide/exporter/exporter_installation",permalink:"/docs/guide/exporter/exporter_installation",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"KubeSkoop exporter visualization",permalink:"/docs/guide/exporter/exporter-visualization-guide"},next:{title:"Running KubeSkoop exporter in sidecar mode",permalink:"/docs/guide/exporter/running-in-sidecar"}},p={},u=[{value:"Dependencies",id:"dependencies",level:2},{value:"Quick Installation",id:"quick-installation",level:2},{value:"Quickly experience",id:"quickly-experience",level:3},{value:"Install only KubeSkoop exporter",id:"install-only-kubeskoop-exporter",level:3},{value:"Install using Helm",id:"install-using-helm",level:2},{value:"Helm Configuration",id:"helm-configuration",level:3},{value:"Verification after installation completion",id:"verification-after-installation-completion",level:3},{value:"Configuration",id:"configuration",level:2}],d={toc:u},k="wrapper";function s(e){let{components:t,...n}=e;return(0,r.kt)(k,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"install-kubeskoop-exporter"},"Install KubeSkoop exporter"),(0,r.kt)("h2",{id:"dependencies"},"Dependencies"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Linux kernel >= 4.9.17 \uff08Some functions can be supported on lower versions of the kernel.\uff09"),(0,r.kt)("li",{parentName:"ul"},"Containers runtime based on Docker/Containerd/Pouch.")),(0,r.kt)("h2",{id:"quick-installation"},"Quick Installation"),(0,r.kt)("h3",{id:"quickly-experience"},"Quickly experience"),(0,r.kt)("p",null,"KubeSkoop exporter provides a quick deployment configuration that includes the following components:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"KubeSkoop exporter."),(0,r.kt)("li",{parentName:"ul"},"Single-instance Prometheus and Grafana components, Grafana Loki component."),(0,r.kt)("li",{parentName:"ul"},"NodePort services of Prometheus and Grafana.")),(0,r.kt)("p",null,"The following steps show how to quickly deploy KubeSkoop exporter and its observability combination with Prometheus, Grafana, and Loki in a Kubernetes cluster:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f https://raw.githubusercontent.com/alibaba/kubeskoop/main/deploy/skoopbundle.yaml\n")),(0,r.kt)("p",null,"Follow the steps below to confirm the installation is complete and obtain the access entry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Check the running status of kubeskoop exporter.\nkubectl get pod -n kubeskoop -l app=kubeskoop-exporter -o wide\n\n# Check the running status of the Probe collector.\nkubectl get --raw /api/v1/namespaces/kubeskoop/pods/{{kubeskoop-exporter pod name}}:9102/proxy/status |jq .\n\n# Obtain the entry for the Prometheus service.\nkubectl get service -n kubeskoop prometheus-service -o wide\n\n# Obtain the access entry for the Grafana console.\nkubectl get service -n kubeskoop grafana -o wide\n")),(0,r.kt)("h3",{id:"install-only-kubeskoop-exporter"},"Install only KubeSkoop exporter"),(0,r.kt)("h2",{id:"install-using-helm"},"Install using Helm"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Add KubeSkoop charts repo\nhelm repo add kubeskoop https://kubeskoop.github.io\n\n# You need to update helm repo info for the first time.\nhelm repo update\n\n# Install KubeSkoop exporter.\nhelm install kubeskoop-exporter kubeskoop/skoop-exporter\n")),(0,r.kt)("p",null,"If you need to debug Helm Charts information, you can install it locally:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Clone KubeSkoop to local disk.\ngit clone https://github.com/alibaba/kubeskoop.git\n\n# Install the helm chart locally.\nhelm install --set namespace=kube-system skoop-exporter ./kubeskoop/deploy/skoop-exporter-0.2.0.tgz --debug\n")),(0,r.kt)("p",null,"KubeSkoop exporter is deployed in the cluster as a DaemonSet and can be verified if it is working properly in the following ways:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Get pod running status of KubeSkoop exporter\nkubectl get pod -n kubeskoop -l app=kubeskoop-exporter -o wide\n\n# After pods are runing, you can get running status of probes through API server.\nkubectl get --raw /api/v1/namespaces/kubeskoop/pods/{{kubeskoop-exporter pod name}}:9102/proxy/status |jq .\n\n\n# You can also curl it if you have direct access to the pod IP.\ncurl {{kubeskoop-exporter pod ip}}:9102/status |jq .\n")),(0,r.kt)("h3",{id:"helm-configuration"},"Helm Configuration"),(0,r.kt)("p",null,"The parameters that can be configured when installing KubeSkoop exporter through Helm are as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Setting"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"name"),(0,r.kt)("td",{parentName:"tr",align:null},"DaemonSet name of KubeSkoop exporter."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kubeskoop-exporter"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"debugmode"),(0,r.kt)("td",{parentName:"tr",align:null},"Enable ",(0,r.kt)("inlineCode",{parentName:"td"},"debugmode")," for kubeskoop-exporter, with debug interface, debug log level and pprof support."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"appName"),(0,r.kt)("td",{parentName:"tr",align:null},"Pod ",(0,r.kt)("inlineCode",{parentName:"td"},"app")," label."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kubeskoop-exporter"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"runtimeEndpoint"),(0,r.kt)("td",{parentName:"tr",align:null},"CRI runtime endpoint socket, you can use  `crictl info"),(0,r.kt)("td",{parentName:"tr",align:null},"awk -F\":\" '/containerdEndpoint/ {print $2'` to obtain it.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"image.repository"),(0,r.kt)("td",{parentName:"tr",align:null},"Image repository for KubeSkoop exporter container."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kubeskoop/kubeskoop"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"image.tag"),(0,r.kt)("td",{parentName:"tr",align:null},"Image tag for KubeSkoop exporter container."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"latest"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"image.imagePullPolicy"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"imagePullPolicy")," for KubeSkoop exporter container."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Always"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"initContainer.enabled"),(0,r.kt)("td",{parentName:"tr",align:null},"Enable ",(0,r.kt)("inlineCode",{parentName:"td"},"btfhack")," as initContainer to automate discover btf file when kernel does not carry btf information itself."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"initContainer.repository"),(0,r.kt)("td",{parentName:"tr",align:null},"Image repository for ",(0,r.kt)("inlineCode",{parentName:"td"},"btfhack")," container."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"registry.cn-hangzhou.aliyuncs.com/acs/btfhack"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"initContainer.tag"),(0,r.kt)("td",{parentName:"tr",align:null},"Image tag for ",(0,r.kt)("inlineCode",{parentName:"td"},"btfhack")," container."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"latest"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"initContainer.imagePullPolicy"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"imagePullPolicy")," for ",(0,r.kt)("inlineCode",{parentName:"td"},"btfhack")," container."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Always"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.enableEventServer"),(0,r.kt)("td",{parentName:"tr",align:null},"Enable the event server and loki."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.enableMetricServer"),(0,r.kt)("td",{parentName:"tr",align:null},"Enable the metric server."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"true"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.remoteLokiAddress"),(0,r.kt)("td",{parentName:"tr",align:null},"Set the remote grafana loki endpoint to push events."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"registry.cn-hangzhou.aliyuncs.com/acs/btfhack"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.metricLabelVerbose"),(0,r.kt)("td",{parentName:"tr",align:null},"Deliever the detail information of pod in metric label, such as app label, ip"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.metricServerPort"),(0,r.kt)("td",{parentName:"tr",align:null},"Metric server port, provide HTTP service."),(0,r.kt)("td",{parentName:"tr",align:null},"9102")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.eventServerPort"),(0,r.kt)("td",{parentName:"tr",align:null},"Event sever port, provide GRPC service."),(0,r.kt)("td",{parentName:"tr",align:null},"19102")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.metricProbes"),(0,r.kt)("td",{parentName:"tr",align:null},"Metric probes to enable."),(0,r.kt)("td",{parentName:"tr",align:null},"Refer to the probe guide.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.eventProbes"),(0,r.kt)("td",{parentName:"tr",align:null},"Event probes to enable."),(0,r.kt)("td",{parentName:"tr",align:null},"Refer to the probe guide.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"config.metricCacheInterval"),(0,r.kt)("td",{parentName:"tr",align:null},"Metric cache interval."),(0,r.kt)("td",{parentName:"tr",align:null},"15")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"expose_labels"),(0,r.kt)("td",{parentName:"tr",align:null},"Extra labels to be exposed."),(0,r.kt)("td",{parentName:"tr",align:null},"See ",(0,r.kt)("inlineCode",{parentName:"td"},"values.yaml"),".")))),(0,r.kt)("h3",{id:"verification-after-installation-completion"},"Verification after installation completion"),(0,r.kt)("p",null,"After completing the installation of KubeSkoop exporter using Helm, you can verify if it is running correctly in the following ways:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Check the running status of the Probe collector.\nkubectl get --raw /api/v1/namespaces/kubeskoop/pods/{{kubeskoop-exporter pod name}}:9102/proxy/status |jq .\n")),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The configuration of KubeSkoop exporter is managed by the ConfigMap object 'inspector-config' by default in the same namespace as the workload. The following methods can be used to modify it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Change the namespace to the actual effective namespace.\nkubectl edit cm -n kubeskoop inspector-config\n")),(0,r.kt)("p",null,"The configuration items supported by KubeSkoop exporter are as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Configuration item"),(0,r.kt)("th",{parentName:"tr",align:null},"Configuration function"),(0,r.kt)("th",{parentName:"tr",align:null},"Default value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"debugmode"),(0,r.kt)("td",{parentName:"tr",align:null},"Debug mode switch. After turning on debug mode, you can obtain more detailed logs and enable pprof and gops interfaces."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"event_config.loki_enable"),(0,r.kt)("td",{parentName:"tr",align:null},"The switch to push event collection service to Grafana Loki."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"event_config.loki_address"),(0,r.kt)("td",{parentName:"tr",align:null},"After enabling the event collection service, configure the Grafana Loki service address where the events need to be pushed through this option."),(0,r.kt)("td",{parentName:"tr",align:null},"``")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"event_config.probes"),(0,r.kt)("td",{parentName:"tr",align:null},"Configure the enabled event collection probes."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"event_config.port"),(0,r.kt)("td",{parentName:"tr",align:null},"The GRPC server port of KubeSkoop exporter provides event streaming service."),(0,r.kt)("td",{parentName:"tr",align:null},"19102")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"metric_config.verbose"),(0,r.kt)("td",{parentName:"tr",align:null},"Get more detailed monitoring metric labels, including the app label and IP address of the Pod."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"false"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"metric_config.port"),(0,r.kt)("td",{parentName:"tr",align:null},"The port of the monitoring metric service that provides HTTP service."),(0,r.kt)("td",{parentName:"tr",align:null},"9102")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"metric_config.probes"),(0,r.kt)("td",{parentName:"tr",align:null},"Configure the enabled monitoring metric probes."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"metric_config.interval"),(0,r.kt)("td",{parentName:"tr",align:null},"The caching period for collecting monitoring metrics, measured in seconds."),(0,r.kt)("td",{parentName:"tr",align:null},"15")))),(0,r.kt)("p",null,"Reference information for the selectable probe configuration can be found at",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/docs/guide/exporter/exporter-description"},"KubeSkoop exporter Introduction"))))}s.isMDXComponent=!0}}]);