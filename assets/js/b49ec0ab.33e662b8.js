"use strict";(self.webpackChunkkubeskoop_io=self.webpackChunkkubeskoop_io||[]).push([[843],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||c[m]||i;return n?o.createElement(h,a(a({ref:t},d),{},{components:n})):o.createElement(h,a({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,a[1]=s;for(var p=2;p<i;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4055:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var o=n(7462),r=(n(7294),n(3905));const i={sidebar_position:1},a="Use CLI",s={unversionedId:"guide/connectivity-diagnosis/use-cli",id:"guide/connectivity-diagnosis/use-cli",title:"Use CLI",description:"KubeSkoop connectivity diagnostics provides a way to directly run from the command line, allowing you to diagnose the cluster on your local computer.",source:"@site/docs/guide/connectivity-diagnosis/use-cli.md",sourceDirName:"guide/connectivity-diagnosis",slug:"/guide/connectivity-diagnosis/use-cli",permalink:"/docs/guide/connectivity-diagnosis/use-cli",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Intro",permalink:"/docs/guide/connectivity-diagnosis/intro"},next:{title:"Monitoring",permalink:"/docs/category/monitoring"}},l={},p=[{value:"Diagnose the cluster",id:"diagnose-the-cluster",level:2},{value:"View diagnosis result through web",id:"view-diagnosis-result-through-web",level:2},{value:"Output format",id:"output-format",level:2},{value:"d2",id:"d2",level:3},{value:"svg",id:"svg",level:3},{value:"json",id:"json",level:3},{value:"Specify the cloud provider",id:"specify-the-cloud-provider",level:2},{value:"Other command line arguments",id:"other-command-line-arguments",level:2}],d={toc:p},u="wrapper";function c(e){let{components:t,...i}=e;return(0,r.kt)(u,(0,o.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"use-cli"},"Use CLI"),(0,r.kt)("p",null,"KubeSkoop connectivity diagnostics provides a way to directly run from the command line, allowing you to diagnose the cluster on your local computer."),(0,r.kt)("p",null,"By default, when diagnosis finished, it will print simple link info and diagnose result to standard output. You can specify ",(0,r.kt)("inlineCode",{parentName:"p"},"--http")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"--format")," to view result via Web UI, or save it into a specified format."),(0,r.kt)("h2",{id:"diagnose-the-cluster"},"Diagnose the cluster"),(0,r.kt)("p",null,"Execute the following command to make a connectivity diagnosis task from ",(0,r.kt)("inlineCode",{parentName:"p"},"172.18.0.4")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"10.96.0.10"),", port 80, and TCP protocol(by default)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"skoop -s 172.18.0.4 -d 10.96.0.10 -p 80\n")),(0,r.kt)("p",null,"When the diagnosis is complete, the packet path and the problems found will be output to the screen."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'$ skoop -s 172.18.0.4 -d 10.96.0.10 -p 53\nPacket path:\n"default/netshoot-6bddd57fb7-49q9s" -> "node1" [label="type=veth,level=0,trans=service,oif=eth0,iif=cni0,src=172.18.0.4,dst=10.96.0.10,dport=53"]\n"node1" -> "kube-system/coredns-547b98dbcc-dxmnl" [label="type=veth,level=1,trans=serve,oif=cni0,iif=eth0,src=172.18.0.4,dst=172.18.0.2,dport=53",arrowhead="dot"]\n"node1" -> "node2" [label="type=infra,level=1,trans=forward,oif=eth0,iif=eth0,src=172.18.0.4,dst=172.18.0.69,dport=53"]\n"node2" -> "kube-system/coredns-547b98dbcc-zr2zl" [label="type=veth,level=2,trans=serve,oif=cni0,iif=eth0,src=172.18.0.4,dst=172.18.0.69,dport=53",arrowhead="dot"]\n\n\nSuspicions on node "kube-system/coredns-547b98dbcc-zr2zl"\n[FATAL] no process listening on 0.0.0.0:80 or 172.18.0.69:80 protocol tcp\n')),(0,r.kt)("h2",{id:"view-diagnosis-result-through-web"},"View diagnosis result through web"),(0,r.kt)("p",null,"By adding the ",(0,r.kt)("inlineCode",{parentName:"p"},"--http")," parameter to the command line, an HTTP server will be launched for viewing the diagnosis results interactively."),(0,r.kt)("p",null,"When the ",(0,r.kt)("inlineCode",{parentName:"p"},"--http")," parameter is used, after the diagnosis completed, an HTTP server is started to accept requests at the specified address, which you can open to view the link graph and final results."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ skoop -s 172.18.0.4 -d 10.96.0.10 -p 53 --http\nI0118 11:43:23.383446    6280 web.go:97] HTTP server listening on http://127.0.0.1:8080\n")),(0,r.kt)("p",null,"The server is started on ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1:8080")," by default, you can also specify the address with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--http-address")," parameter."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you are running diagnostics in Docker container or on a remote server, you may need to set ",(0,r.kt)("inlineCode",{parentName:"p"},"--http-address")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"0.0.0.0:8080")," for remote address access. Take Docker as an example:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -p 8080:8080 -v ~/.kube:/root/.kube kubeskoop/kubeskoop:latest skoop -s 172.18.0.4 -d 10.96.0.10 -p 80 --http --http-address=0.0.0.0:8080\n"))),(0,r.kt)("p",null,"After opening ",(0,r.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:8080")," through your browser, you can see the diagnostic results:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"diagnose_web",src:n(7530).Z,width:"1509",height:"888"})),(0,r.kt)("h2",{id:"output-format"},"Output format"),(0,r.kt)("p",null,"You can specify the output format with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--format")," parameter.\nIf you do not specify the output format, it will output simple link information and diagnostic results in the standard output by default when the diagnosis is finished."),(0,r.kt)("p",null,"Currently, ",(0,r.kt)("inlineCode",{parentName:"p"},"d2"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"svg"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"json")," output is supported."),(0,r.kt)("p",null,"In addition, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"--output")," to specify the output filename (defaults to result.d2/svg/json), and can also specify ",(0,r.kt)("inlineCode",{parentName:"p"},"-")," to indicate output to standard output."),(0,r.kt)("h3",{id:"d2"},"d2"),(0,r.kt)("p",null,"Output format ",(0,r.kt)("inlineCode",{parentName:"p"},"d2"),". For more information about ",(0,r.kt)("inlineCode",{parentName:"p"},"d2")," syntax, please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://d2lang.com/tour/intr"},"documentation"),"."),(0,r.kt)("p",null,"This output format contains only the generated link information and does not contain the diagnosis result."),(0,r.kt)("h3",{id:"svg"},"svg"),(0,r.kt)("p",null,"Output format ",(0,r.kt)("inlineCode",{parentName:"p"},"svg"),", generated by ",(0,r.kt)("inlineCode",{parentName:"p"},"d2")," file."),(0,r.kt)("p",null,"This output format contains only the generated link information and does not contain the diagnosis result."),(0,r.kt)("h3",{id:"json"},"json"),(0,r.kt)("p",null,"Output format ",(0,r.kt)("inlineCode",{parentName:"p"},"json"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"json")," output format contains details of the nodes and edges in the link graph, as well as the diagnosis result in cluster."),(0,r.kt)("h2",{id:"specify-the-cloud-provider"},"Specify the cloud provider"),(0,r.kt)("p",null,"KubeSkoop supports specifying the cloud provider to provide diagnosis for resource configuration on the cloud."),(0,r.kt)("p",null,"After specifying the cloud provider via the ",(0,r.kt)("inlineCode",{parentName:"p"},"--cloud-provider")," parameter,\nConnectivity Diagnostics will check the on-cloud resource configurations such as VM security groups, routing tables, NAT, etc."),(0,r.kt)("p",null,"Currently supported cloud providers and the extra arguments needed, please refer to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/connectivity-diagnosis/cloud-providers"},"documentation"),"."),(0,r.kt)("h2",{id:"other-command-line-arguments"},"Other command line arguments"),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--help")," parameter to see the rest of the parameters and their usage, or refer to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/connectivity-diagnosis/command-line-arguments"},"documentation"),"."))}c.isMDXComponent=!0},7530:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/intro_diagnose_web-5cc33839caa1aeb8aa1b88f317a73e75.jpg"}}]);